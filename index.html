<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crypto Trading Bot - Simulador Profesional</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Outfit:wght@300;600;800&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <header>
            <h1>ü§ñ CRYPTO TRADING BOT</h1>
            <p class="subtitle">An√°lisis T√©cnico Profesional | EMA ‚Ä¢ RSI ‚Ä¢ Volumen ‚Ä¢ Trailing Stop</p>
        </header>

        <!-- TABS -->
        <div class="tabs">
            <button class="tab active" data-tab="manual" onclick="switchTab('manual')">
                üìä Trading Manual
            </button>
            <button class="tab" data-tab="optimizer" onclick="switchTab('optimizer')">
                ü§ñ Auto-Optimizaci√≥n
            </button>
        </div>

        <!-- TAB 1: MANUAL TRADING -->
        <div id="manual-tab" class="tab-content active">
            <div class="dashboard">
                <div class="stat-card">
                    <div class="stat-label">üí∞ Capital Total</div>
                    <div class="stat-value" id="totalBalance">$1,000.00</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">üíµ Efectivo</div>
                    <div class="stat-value" id="cashBalance">$1,000.00</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">üìä Posiciones</div>
                    <div class="stat-value" id="activeInvestments">0/3</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">üìà P&L Total</div>
                    <div class="stat-value positive" id="totalProfits">$0.00</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">‚úÖ Trades Ganadores</div>
                    <div class="stat-value" id="successTrades">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">‚ùå Trades Perdedores</div>
                    <div class="stat-value" id="lossTrades">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">üîÑ Trades On Hold</div>
                    <div class="stat-value" id="onHoldTrades">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">üìâ Win Rate</div>
                    <div class="stat-value" id="winRate">0%</div>
                </div>
            </div>

            <div class="main-grid">
                <!-- PANEL DE CONTROL -->
                <div class="section">
                    <div class="section-title">‚öôÔ∏è Configuraci√≥n</div>
                    
                    <div class="controls-grid">
                        <div class="form-group">
                            <label for="emaFast">EMA R√°pida</label>
                            <input type="number" id="emaFast" value="20" min="5" max="50">
                        </div>
                        <div class="form-group">
                            <label for="emaSlow">EMA Lenta</label>
                            <input type="number" id="emaSlow" value="50" min="20" max="200">
                        </div>
                        <div class="form-group">
                            <label for="rsiPeriod">Per√≠odo RSI</label>
                            <input type="number" id="rsiPeriod" value="14" min="7" max="21">
                        </div>
                        <div class="form-group">
                            <label for="rsiMin">RSI M√≠nimo</label>
                            <input type="number" id="rsiMin" value="50" min="20" max="50">
                        </div>
                        <div class="form-group">
                            <label for="rsiMax">RSI M√°ximo</label>
                            <input type="number" id="rsiMax" value="70" min="50" max="90">
                        </div>
                        <div class="form-group">
                            <label for="volumeMult">Mult. Volumen</label>
                            <input type="number" id="volumeMult" value="1.2" min="1.0" max="2.0" step="0.1">
                        </div>
                        <div class="form-group">
                            <label for="stopType">Tipo de Stop</label>
                            <select id="stopType">
                                <option value="fixed">Fijo %</option>
                                <option value="technical">T√©cnico</option>
                            </select>
                        </div>
                        <div class="form-group" id="stopFixedRow">
                            <label for="stopLossPct">Stop Loss %</label>
                            <input type="number" id="stopLossPct" value="5" min="1" max="20">
                        </div>
                        <div class="form-group">
                            <label for="timeoutCandles">Timeout (velas)</label>
                            <input type="number" id="timeoutCandles" value="100" min="10" max="500">
                        </div>
                        <div class="form-group">
                            <label for="tp1">Take Profit 1 %</label>
                            <input type="number" id="tp1" value="2" min="0.5" max="10" step="0.5">
                        </div>
                        <div class="form-group">
                            <label for="tp2">Take Profit 2 %</label>
                            <input type="number" id="tp2" value="5" min="1" max="20" step="0.5">
                        </div>
                        <div class="form-group">
                            <label for="trailingPct">Trailing Stop %</label>
                            <input type="number" id="trailingPct" value="1" min="0.2" max="5" step="0.1">
                        </div>
                        <div class="form-group">
                            <label for="riskPct">Risk por Trade %</label>
                            <input type="number" id="riskPct" value="5" min="1" max="20">
                        </div>
                        <div class="form-group">
                            <label for="maxPositions">M√°x. Posiciones</label>
                            <input type="number" id="maxPositions" value="3" min="1" max="10">
                        </div>
                        <div class="form-group">
                            <label for="timeSpeed">Velocidad</label>
                            <select id="timeSpeed">
                                <option value="3000">Tiempo Real</option>
                                <option value="1000" selected>R√°pido</option>
                                <option value="500">Muy R√°pido</option>
                                <option value="100">Ultra R√°pido</option>
                                <option value="50">M√°ximo</option>
                            </select>
                        </div>
                    </div>

                    <div class="control-buttons">
                        <button class="control-btn" id="startBtn">‚ñ∂Ô∏è Iniciar</button>
                        <button class="control-btn secondary" id="stopBtn" disabled>‚è∏Ô∏è Detener</button>
                        <button class="control-btn danger" id="resetBtn">üîÑ Reset</button>
                    </div>

                    <div id="simulationTime" style="margin-top: 15px; font-size: 0.85rem; color: var(--text-secondary); text-align: center;">
                        üìÖ Tiempo simulado: 0 d√≠as, 0h (0 velas)<br>
                        ‚è±Ô∏è Tiempo real: 0s
                    </div>
                </div>

                <!-- MERCADO -->
                <div class="section">
                    <div class="section-title">üìà Mercado</div>
                    <div class="scroll-container" id="cryptoList">
                        <p style="color: var(--text-secondary); text-align: center; padding: 20px;">
                            Iniciando...
                        </p>
                    </div>
                </div>

                <!-- POSICIONES -->
                <div class="section">
                    <div class="section-title">üíº Posiciones Activas</div>
                    <div class="scroll-container" id="investmentsList">
                        <p style="color: var(--text-secondary); text-align: center; padding: 20px; font-size: 0.85rem;">
                            Sin posiciones abiertas
                        </p>
                    </div>
                </div>
            </div>

            <!-- LOG -->
            <div class="section">
                <div class="section-title">üìú Registro</div>
                <div class="scroll-container" id="activityLog"></div>
            </div>
        </div>
        <!-- FIN TAB MANUAL -->

        <!-- TAB 2: AUTO-OPTIMIZACI√ìN -->
        <div id="optimizer-tab" class="tab-content">
            <div id="optimizer-container"></div>
            
            <div style="text-align: center; margin-top: 30px;">
                <button class="control-btn" id="optimizerStartBtn" onclick="startOptimizer()">
                    ‚ñ∂Ô∏è Iniciar Auto-Optimizaci√≥n
                </button>
                <button class="control-btn secondary" id="optimizerStopBtn" onclick="stopOptimizer()" disabled>
                    ‚è∏Ô∏è Detener
                </button>
            </div>
        </div>
        <!-- FIN TAB OPTIMIZER -->
    </div>

    <!-- Scripts -->
    <script>
        // Sistema de Tabs
        function switchTab(tabName) {
            // Ocultar todos los tabs
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Quitar active de todos los botones
            document.querySelectorAll('.tab').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Activar el tab seleccionado
            document.getElementById(tabName + '-tab').classList.add('active');
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
            
            console.log('‚úÖ Cambiado a tab:', tabName);
        }
        
        // Variables globales para optimizer
        let optimizerManager = null;
        let optimizerUI = null;
        
        function startOptimizer() {
            if (!optimizerManager) {
                // Inicializar por primera vez
                optimizerManager = new OptimizerManager('https://crypto-simulator-back.onrender.com');
                optimizerUI = new OptimizerUI('optimizer-container');
                optimizerManager.setUIRenderer(optimizerUI);
                
                optimizerManager.initialize().then(() => {
                    optimizerManager.startAll();
                    optimizerUI.startAutoUpdate(optimizerManager.bots, 2000);
                    
                    document.getElementById('optimizerStartBtn').disabled = true;
                    document.getElementById('optimizerStopBtn').disabled = false;
                    
                    console.log('‚úÖ Optimizer iniciado');
                });
            } else {
                // Ya existe, solo reiniciar
                optimizerManager.startAll();
                optimizerUI.startAutoUpdate(optimizerManager.bots, 2000);
                
                document.getElementById('optimizerStartBtn').disabled = true;
                document.getElementById('optimizerStopBtn').disabled = false;
            }
        }
        
        function stopOptimizer() {
            if (optimizerManager) {
                optimizerManager.stopAll();
                optimizerUI.stopAutoUpdate();
                
                document.getElementById('optimizerStartBtn').disabled = false;
                document.getElementById('optimizerStopBtn').disabled = true;
                
                console.log('‚è∏Ô∏è Optimizer detenido');
            }
        }
    </script>
    
    <script src="app-backend.js"></script>
    <script src="app-optimizer.js"></script>
    <script src="optimizer-ui.js"></script>
</body>
</html>
