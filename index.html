<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crypto Trading Bot - Simulador Profesional</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Outfit:wght@300;600;800&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <header>
            <h1>ü§ñ CRYPTO TRADING BOT</h1>
            <p class="subtitle">An√°lisis T√©cnico Profesional | EMA ‚Ä¢ RSI ‚Ä¢ Volumen ‚Ä¢ Trailing Stop</p>
        </header>

        <!-- TABS -->
        <div class="tabs">
            <button class="tab active" data-tab="manual" onclick="switchTab('manual')">
                üìä Trading Manual
            </button>
            <button class="tab" data-tab="optimizer" onclick="switchTab('optimizer')">
                ü§ñ Auto-Optimizaci√≥n
            </button>
        </div>

        <!-- TAB 1: MANUAL TRADING (actual) -->
        <div id="manual-tab" class="tab-content active">
        <div class="dashboard">
            <div class="stat-card">
                <div class="stat-label">üí∞ Capital Total</div>
                <div class="stat-value" id="totalBalance">$1,000.00</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">üíµ Efectivo</div>
                <div class="stat-value" id="cashBalance">$1,000.00</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">üìä Posiciones</div>
                <div class="stat-value" id="activeInvestments">0/3</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">üìà P&L Total</div>
                <div class="stat-value positive" id="totalProfits">$0.00</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">‚úÖ Trades Ganadores</div>
                <div class="stat-value" id="successTrades">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">‚ùå Trades Perdedores</div>
                <div class="stat-value" id="lossTrades">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">üîÑ Trades On Hold</div>
                <div class="stat-value" id="onHoldTrades">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">üìâ Win Rate</div>
                <div class="stat-value" id="winRate">0%</div>
            </div>
        </div>

        <div class="main-content">
            <!-- CONFIGURACI√ìN -->
            <div class="section">
                <div class="section-title">‚öôÔ∏è Configuraci√≥n</div>
                
                <div class="config-panel">
                    <div class="config-title">üìä Indicadores</div>
                    <div class="config-row">
                        <label class="config-label">EMA R√°pida</label>
                        <input type="number" id="emaFast" value="20" min="5" max="50">
                    </div>
                    <div class="config-row">
                        <label class="config-label">EMA Lenta</label>
                        <input type="number" id="emaSlow" value="50" min="20" max="200">
                    </div>
                    <div class="config-row">
                        <label class="config-label">RSI Per√≠odo</label>
                        <input type="number" id="rsiPeriod" value="14" min="5" max="30">
                    </div>
                    <div class="config-row">
                        <label class="config-label">RSI M√≠n</label>
                        <input type="number" id="rsiMin" value="50" min="30" max="70">
                    </div>
                    <div class="config-row">
                        <label class="config-label">RSI M√°x</label>
                        <input type="number" id="rsiMax" value="70" min="50" max="90">
                    </div>
                    <div class="config-row">
                        <label class="config-label">Volumen Mult.</label>
                        <input type="number" id="volumeMult" value="1.2" min="1" max="3" step="0.1">
                    </div>
                </div>

                <div class="config-panel">
                    <div class="config-title">üõë Stop Loss</div>
                    <div class="config-row">
                        <label class="config-label">Tipo</label>
                        <select id="stopType">
                            <option value="fixed">Fijo (%)</option>
                            <option value="technical">T√©cnico (m√≠n 10 velas)</option>
                        </select>
                    </div>
                    <div class="config-row" id="stopFixedRow">
                        <label class="config-label">Stop Loss (%)</label>
                        <input type="number" id="stopLossPct" value="2" min="0.5" max="10" step="0.5">
                    </div>
                    <div class="config-row">
                        <label class="config-label">Timeout (velas)</label>
                        <input type="number" id="timeoutCandles" value="30" min="5" max="100" step="5">
                    </div>
                </div>

                <div class="config-panel">
                    <div class="config-title">üéØ Take Profit</div>
                    <div class="config-row">
                        <label class="config-label">TP1 (%) - Vende 50%</label>
                        <input type="number" id="tp1" value="2" min="0.5" max="10" step="0.5">
                    </div>
                    <div class="config-row">
                        <label class="config-label">TP2 (%) - Vende 100%</label>
                        <input type="number" id="tp2" value="4" min="1" max="20" step="0.5">
                    </div>
                    <div class="config-row">
                        <label class="config-label">Trailing (%)</label>
                        <input type="number" id="trailingPct" value="2" min="0.5" max="5" step="0.5">
                    </div>
                </div>

                <div class="config-panel">
                    <div class="config-title">üíº Gesti√≥n</div>
                    <div class="config-row">
                        <label class="config-label">Riesgo por Trade (%)</label>
                        <input type="number" id="riskPct" value="1" min="0.5" max="5" step="0.5">
                    </div>
                    <div class="config-row">
                        <label class="config-label">M√°x Posiciones</label>
                        <input type="number" id="maxPositions" value="3" min="1" max="10">
                    </div>
                </div>

                <div class="config-panel" style="background: rgba(168, 85, 247, 0.05); border-color: rgba(168, 85, 247, 0.2);">
                    <div class="config-title" style="color: var(--accent-purple);">‚ö° Acelerador de Tiempo</div>
                    <div class="config-row">
                        <label class="config-label">Velocidad de Simulaci√≥n</label>
                        <select id="timeSpeed">
                            <option value="3000">‚è±Ô∏è Tiempo Real (1 vela = 3s)</option>
                            <option value="1000">üèÉ R√°pido (1 vela = 1s)</option>
                            <option value="500" selected>‚ö° Muy R√°pido (1 vela = 0.5s)</option>
                            <option value="100">üöÄ Ultra R√°pido (1 vela = 0.1s)</option>
                            <option value="50">üí´ M√°ximo (1 vela = 0.05s)</option>
                        </select>
                    </div>
                    <div style="margin-top: 12px; padding: 10px; background: var(--bg-secondary); border-radius: 6px; font-size: 0.7rem; color: var(--text-secondary);">
                        <strong style="color: var(--accent-purple);">üìä Equivalencias:</strong><br>
                        ‚Ä¢ Ultra R√°pido: ~1 mes en 50 segundos<br>
                        ‚Ä¢ M√°ximo: ~1 mes en 25 segundos<br>
                        <div id="simulationTime" style="margin-top: 6px; color: var(--accent-green); font-weight: 700;"></div>
                    </div>
                </div>

                <div class="controls">
                    <button class="btn-primary" id="startBtn">‚ñ∂Ô∏è Iniciar</button>
                    <button class="btn-secondary" id="stopBtn" disabled>‚è∏Ô∏è Detener</button>
                </div>
                <button class="btn-secondary" id="resetBtn" style="width: 100%; margin-top: 10px;">üîÑ Reiniciar</button>
            </div>

            <!-- MERCADO -->
            <div>
                <div class="section">
                    <div class="section-title">üìà An√°lisis de Mercado</div>
                    <div class="scroll-container" id="cryptoList"></div>
                </div>

                <div class="section" style="margin-top: 20px;">
                    <div class="section-title">üìä Posiciones Activas</div>
                    <div id="investmentsList">
                        <p style="color: var(--text-secondary); text-align: center; padding: 20px; font-size: 0.85rem;">
                            Sin posiciones abiertas
                        </p>
                    </div>
                </div>
            </div>

            <!-- LOG -->
            <div class="section">
                <div class="section-title">üìú Registro</div>
                <div class="scroll-container" id="activityLog"></div>
            </div>
        </div>
        </div>
        <!-- FIN TAB MANUAL -->

        <!-- TAB 2: AUTO-OPTIMIZACI√ìN -->
        <div id="optimizer-tab" class="tab-content">
            <div id="optimizer-container"></div>
            
            <div style="text-align: center; margin-top: 30px;">
                <button class="control-btn" id="optimizerStartBtn" onclick="startOptimizer()">
                    ‚ñ∂Ô∏è Iniciar Auto-Optimizaci√≥n
                </button>
                <button class="control-btn secondary" id="optimizerStopBtn" onclick="stopOptimizer()" disabled>
                    ‚è∏Ô∏è Detener
                </button>
            </div>
        </div>
        <!-- FIN TAB OPTIMIZER -->
    </div>

    <!-- Scripts -->
    <script>
        // Sistema de Tabs
        function switchTab(tabName) {
            // Ocultar todos los tabs
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Quitar active de todos los botones
            document.querySelectorAll('.tab').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Activar el tab seleccionado
            document.getElementById(tabName + '-tab').classList.add('active');
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
        }
        
        // Variables globales para optimizer
        let optimizerManager = null;
        let optimizerUI = null;
        
        function startOptimizer() {
            if (!optimizerManager) {
                // Inicializar por primera vez
                optimizerManager = new OptimizerManager('https://crypto-simulator-back.onrender.com');
                optimizerUI = new OptimizerUI('optimizer-container');
                optimizerManager.setUIRenderer(optimizerUI);
                
                optimizerManager.initialize().then(() => {
                    optimizerManager.startAll();
                    optimizerUI.startAutoUpdate(optimizerManager.bots, 2000);
                    
                    document.getElementById('optimizerStartBtn').disabled = true;
                    document.getElementById('optimizerStopBtn').disabled = false;
                });
            } else {
                // Ya existe, solo reiniciar
                optimizerManager.startAll();
                optimizerUI.startAutoUpdate(optimizerManager.bots, 2000);
                
                document.getElementById('optimizerStartBtn').disabled = true;
                document.getElementById('optimizerStopBtn').disabled = false;
            }
        }
        
        function stopOptimizer() {
            if (optimizerManager) {
                optimizerManager.stopAll();
                optimizerUI.stopAutoUpdate();
                
                document.getElementById('optimizerStartBtn').disabled = false;
                document.getElementById('optimizerStopBtn').disabled = true;
            }
        }
    </script>
    
    <script src="app-backend.js"></script>
    <script src="app-optimizer.js"></script>
    <script src="optimizer-ui.js"></script>
</body>
</html>
